<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><title>ESP32 Management AP</title><style>body{width:fit-content}table,th,tr{border:1px solid;border-collapse:collapse;text-align:center}td,th{padding:10px}tr.selected,tr:hover{background-color:#add8e6;cursor:pointer}</style></head><body onload="getStatus()"><h1>ESP32 Wi-Fi Pen Tool</h1><section id="errors"></section><section id="loading">Loading... Please wait</section><section id="ready" style="display: none;"><h2>Attack configuration</h2><form onsubmit="runAttack(); return false;"><fieldset><legend>Select target</legend><table id="ap-list"></table><p><button type="button" onclick="refreshAps()">Refresh</button></p></fieldset><fieldset><legend>Attack configuration</legend><p><label for="attack_type">Attack type:</label> <select id="attack_type" onchange="updateConfigurableFields(this)" required=""><option value="0" title="This type is not implemented yet." disabled="disabled">ATTACK_TYPE_PASSIVE</option><option value="1">ATTACK_TYPE_HANDSHAKE</option><option value="2" selected="selected">ATTACK_TYPE_PMKID</option><option value="3">ATTACK_TYPE_DOS</option></select></p><p><label for="attack_method">Attack method:</label> <select id="attack_method" required="" disabled="disabled"><option value="" selected="selected" disabled="disabled" hidden="">NOT AVAILABLE</option></select></p><p><label for="attack_timeout">Attack timeout (seconds):</label> <input type="number" min="0" max="255" id="attack_timeout" value="" required=""></p><p><button>Attack</button></p></fieldset></form></section><section id="running" style="display: none;">Time elapsed: <span id="running-progress"></span></section><section id="result" style="display: none;"><div id="result-meta">Loading result.. Please wait</div><div id="result-content"></div><button type="button" onclick="resetAttack()">New attack</button></section><script>var poll,running_poll,AttackStateEnum={READY:0,RUNNING:1,FINISHED:2,TIMEOUT:3},AttackTypeEnum={ATTACK_TYPE_PASSIVE:0,ATTACK_TYPE_HANDSHAKE:1,ATTACK_TYPE_PMKID:2,ATTACK_TYPE_DOS:3},selectedApElement=-1,poll_interval=1e3,running_poll_interval=1e3,attack_timeout=0,time_elapsed=0,defaultResultContent=document.getElementById("result").innerHTML,defaultAttackMethods=document.getElementById("attack_method").outerHTML;function getStatus(){var r=new XMLHttpRequest;r.onload=function(){var e=r.response;if(e){var t=parseInt(new Uint8Array(e,0,1)),n=parseInt(new Uint8Array(e,1,1)),o=parseInt(new Uint16Array(e,2,1)),a=new Uint8Array(e,4);console.log("attack_state="+t+"; attack_type="+n+"; attack_count_size="+o);switch(hideAllSections(),t){case AttackStateEnum.READY:showAttackConfig();break;case AttackStateEnum.RUNNING:showRunning(),console.log("Poll"),setTimeout(getStatus,poll_interval);break;case AttackStateEnum.FINISHED:showResult("FINISHED",n,o,a);break;case AttackStateEnum.TIMEOUT:showResult("TIMEOUT",n,o,a);break;default:document.getElementById("errors").innerHTML="Error loading attack status! Unknown state."}}},r.onerror=function(){console.log("Request error"),document.getElementById("errors").innerHTML="Cannot reach ESP32. Check that you are connected to management AP. You might get disconnected during attack.",getStatus()},r.ontimeout=function(){console.log("Request timeout"),getStatus()},r.open("GET","http://192.168.4.1/status",!0),r.responseType="arraybuffer",r.send()}function hideAllSections(){for(var e of document.getElementsByTagName("section"))e.style.display="none"}function showRunning(){hideAllSections(),document.getElementById("running").style.display="block"}function countProgress(){attack_timeout<=time_elapsed&&(document.getElementById("errors").innerHTML="Please reconnect to management AP",document.getElementById("errors").style.display="block",clearInterval(running_poll)),document.getElementById("running-progress").innerHTML=time_elapsed+"/"+attack_timeout+"s",time_elapsed++}function showAttackConfig(){document.getElementById("ready").style.display="block",refreshAps()}function showResult(e,t,n,o){switch(hideAllSections(),clearInterval(poll),document.getElementById("result").innerHTML=defaultResultContent,document.getElementById("result").style.display="block",document.getElementById("result-meta").innerHTML=e+"<br>",type="ERROR: Cannot parse attack type.",t){case AttackTypeEnum.ATTACK_TYPE_PASSIVE:type="ATTACK_TYPE_PASSIVE";break;case AttackTypeEnum.ATTACK_TYPE_HANDSHAKE:type="ATTACK_TYPE_HANDSHAKE",resultHandshake(o,n);break;case AttackTypeEnum.ATTACK_TYPE_PMKID:type="ATTACK_TYPE_PMKID",resultPmkid(o,n);break;case AttackTypeEnum.ATTACK_TYPE_DOS:type="ATTACK_TYPE_DOS";break;default:type="UNKNOWN"}document.getElementById("result-meta").innerHTML+=type+"<br>"}function refreshAps(){document.getElementById("ap-list").innerHTML="Loading (this may take a while)...";var t=new XMLHttpRequest;t.onload=function(){document.getElementById("ap-list").innerHTML="<th>SSID</th><th>BSSID</th><th>RSSI</th>";var e=t.response;if(e){var n=new Uint8Array(e);for(let t=0;t<n.byteLength;t+=40){var o=document.createElement("tr");o.setAttribute("id",t/40),o.setAttribute("onClick","selectAp(this)");var a=document.createElement("td"),r=document.createElement("td"),c=document.createElement("td");a.innerHTML=new TextDecoder("utf-8").decode(n.subarray(t+0,t+32)),o.appendChild(a);for(let e=0;e<6;e++)c.innerHTML+=uint8ToHex(n[t+33+e])+":";o.appendChild(c),r.innerHTML=n[t+39]-255,o.appendChild(r),document.getElementById("ap-list").appendChild(o)}}},t.onerror=function(){document.getElementById("ap-list").innerHTML="ERROR"},t.open("GET","http://192.168.4.1/ap-list",!0),t.responseType="arraybuffer",t.send()}function selectAp(e){console.log(e.id),-1!=selectedApElement&&selectedApElement.classList.remove("selected"),(selectedApElement=e).classList.add("selected")}function runAttack(){if(-1==selectedApElement)return console.log("No AP selected. Attack not started."),void(document.getElementById("errors").innerHTML="No AP selected. Attack not started.");hideAllSections(),document.getElementById("running").style.display="block";var e=new ArrayBuffer(4),t=new Uint8Array(e);t[0]=parseInt(selectedApElement.id),t[1]=parseInt(document.getElementById("attack_type").value),t[2]=parseInt(document.getElementById("attack_method").value),t[3]=parseInt(document.getElementById("attack_timeout").value);t=new XMLHttpRequest;t.open("POST","http://192.168.4.1/run-attack",!0),t.send(e),getStatus(),attack_timeout=parseInt(document.getElementById("attack_timeout").value),time_elapsed=0,running_poll=setInterval(countProgress,running_poll_interval)}function resetAttack(){hideAllSections(),showAttackConfig();var e=new XMLHttpRequest;e.open("HEAD","http://192.168.4.1/reset",!0),e.send()}function resultPmkid(t,n){var o="",a="",r="",c="",l="",u=0;for(let e=0;e<6;e+=1)o+=uint8ToHex(t[u+e]);u+=6;for(let e=0;e<6;e+=1)a+=uint8ToHex(t[u+e]);u+=6;for(let e=0;e<t[u];e+=1)r+=uint8ToHex(t[u+1+e]),c+=String.fromCharCode(t[u+1+e]);var u=u+t[u]+1,d=0;for(let e=0;e<n-u;e+=1)e%16==0&&(l+="<br>",l+="</code>PMKID #"+d+": <code>",d+=1),l+=uint8ToHex(t[u+e]);document.getElementById("result-content").innerHTML="",document.getElementById("result-content").innerHTML+="MAC AP: <code>"+o+"</code><br>",document.getElementById("result-content").innerHTML+="MAC STA: <code>"+a+"</code><br>",document.getElementById("result-content").innerHTML+="(E)SSID: <code>"+r+"</code> ("+c+")",document.getElementById("result-content").innerHTML+="<code>"+l+"</code><br>",document.getElementById("result-content").innerHTML+="<br>Hashcat ready format:",document.getElementById("result-content").innerHTML+="<code>"+l+"*"+o+"*"+a+"*"+r+"</code><br>"}function resultHandshake(t,n){document.getElementById("result-content").innerHTML="";var e=document.createElement("a");e.setAttribute("href","capture.pcap"),e.text="Download PCAP file";var o=document.createElement("a");o.setAttribute("href","capture.hccapx"),o.text="Download HCCAPX file",document.getElementById("result-content").innerHTML+="<p>"+e.outerHTML+"</p>",document.getElementById("result-content").innerHTML+="<p>"+o.outerHTML+"</p>";var a="";for(let e=0;e<n;e+=1)a+=uint8ToHex(t[e]),e%50==49&&(a+="\n");document.getElementById("result-content").innerHTML+="<pre><code>"+a+"</code></pre>"}function uint8ToHex(e){return("00"+e.toString(16)).slice(-2)}function updateConfigurableFields(e){switch(document.getElementById("attack_method").outerHTML=defaultAttackMethods,parseInt(e.value)){case AttackTypeEnum.ATTACK_TYPE_PASSIVE:console.log("PASSIVE configuration");break;case AttackTypeEnum.ATTACK_TYPE_HANDSHAKE:console.log("HANDSHAKE configuration"),document.getElementById("attack_timeout").value=60,setAttackMethods(["DEAUTH_ROGUE_AP (PASSIVE)","DEAUTH_BROADCAST (ACTIVE)","CAPTURE_ONLY (PASSIVE)"]);break;case AttackTypeEnum.ATTACK_TYPE_PMKID:console.log("PMKID configuration"),document.getElementById("attack_timeout").value=5;break;case AttackTypeEnum.ATTACK_TYPE_DOS:console.log("DOS configuration"),document.getElementById("attack_timeout").value=120,setAttackMethods(["DEAUTH_ROGUE_AP (PASSIVE)","DEAUTH_BROADCAST (ACTIVE)","DEAUTH_COMBINE_ALL"]);break;default:console.log("Unknown attack type")}}function setAttackMethods(e){document.getElementById("attack_method").removeAttribute("disabled"),e.forEach(function(e,t){let n=document.createElement("option");n.value=t,n.text=e,n.selected=!0,document.getElementById("attack_method").appendChild(n)})}</script></body></html>